{
  "hash": "f4923165ef8e2af4f5da9217f361fcf6",
  "result": {
    "markdown": "---\ntitle: \"Petroleum\"\nauthor: \"Jorge Luiz Mendes\"\ndate: \"2022-07-04\"\ncategories: [analysis,new,code,ANP]\nimage: \"image1.png\"\ndescription: \"Panorama a respeito do petróleo e biblioteca ggplot\"\n---\n\n\n# Introdução\n\nO petróleo é um recurso extremamente necessário, presente em diversos setores da economia (indústria, agricultura, combustíveis, e etc).\n\n![](image1.png){fig-align=\"center\" width=\"188\"}\n\n[Link do Ícone](<a href=\"https://www.flaticon.com/br/icones-gratis/barril-de-oleo\" title=\"barril de óleo ícones\">Barril de óleo ícones criados por mangsaabguru - Flaticon</a>)\n\n# Objetivo\n\nAnalisar a produção de petróleo no Brasil. Para essa tarefa foram coletados dados da [Agência Nacional do Petróleo](https://www.gov.br/anp/pt-br) (ANP). A proposta é gerar diversos tipos de visualização com a biblioteca ggplot.\n\n## Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gghighlight)\nlibrary(magrittr)\nlibrary(plyr)\nlibrary(knitr)\nlibrary(geobr)\n```\n:::\n\n\n::: callout-note\n## E para que servem essas bibliotecas?\n\nO [Tidyverse](https://www.tidyverse.org) é um conjunto de bibliotecas muito útil que pode ser carregada rapidamente.\n\n![](https://oliviergimenez.github.io/intro_tidyverse/assets/img/01_tidyverse_data_science.png){fig-alt=\"https://oliviergimenez.github.io/intro_tidyverse\" fig-align=\"center\" width=\"483\"}\n\n-   readr: Importar/Carregar dados;\n\n-   dplyr(tidyr, tibble, plyr): Manipulação e transformação de dados;\n\n-   ggplot: Visualização de dados;\n\n-   magrittr: Operador Pipe(\"O velho %\\>%\") facilita a escrita do código. Também existe o novo pipe (\"\\|\\>\") nativo nas versões atuais do RStudio;\n\n-   knitr: Ajuda a formatar tabelas.\n:::\n\n## Visão Geral\n\nQuais países possuem as maiores reservas de petróleo?\n\nCarregando os dados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nReserva_internacional <- readr::read_csv2(\"https://www.gov.br/anp/pt-br/centrais-de-conteudo/publicacoes/anuario-estatistico/arquivos-anuario-estatistico-2021-metadados-pdf-e-dados-abertos-csv/secao-1-panorama-internacional/dados-abertos-csv/anuario-2021-dados_abertos-tabela1-1.csv\")\n```\n:::\n\n\nPlotando o Gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nReserva_internacional %>% filter(ANO ==2020) %>% \n  arrange(desc(`VALOR DA RESERVA`)) %>% slice(1:10) %>% \n    ggplot() +\n        aes(x =`VALOR DA RESERVA`,y =reorder(PAÍS,`VALOR DA RESERVA`),\n            fill = BLOCO,label =`VALOR DA RESERVA` ) +\n    geom_col() +\n          scale_fill_manual(values = c(\"orange\",\"seagreen3\")) +\n          labs(x =\"Bilhões de Barris\", y = \"\") +\n          \n          ggtitle(\"As 10 Maiores Reservas de Petróleo em 2020\") +\n          geom_label(size =3)\n```\n\n::: {.cell-output-display}\n![](Petroleum_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nA OPEP (Organização dos Países Exportadores de Petróleo) é uma organização que tem por objetivo regular a produção do petróleo para dar estabilidade no mercado internacionall.\n\nQuem são maiores produtores?\n\nCarregando os dados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nProducao_internacional <- readr::read_csv2(\"https://www.gov.br/anp/pt-br/centrais-de-conteudo/publicacoes/anuario-estatistico/arquivos-anuario-estatistico-2021-metadados-pdf-e-dados-abertos-csv/secao-1-panorama-internacional/dados-abertos-csv/anuario-2021-dados_abertos-tabela1-2.csv\")\n```\n:::\n\n\nPlotando o Gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n Producao_internacional %>% filter(ANO == 2020) %>% \n  arrange(desc(PRODUÇÃO)) %>% slice(1:10) %>%   \n  ggplot() +\n      aes(x =PRODUÇÃO ,y =reorder(PAÍS,PRODUÇÃO),fill=BLOCO, label = PRODUÇÃO) +\n        \n      geom_col() +\n           scale_fill_manual(values = c(\"orange\",\"seagreen3\")) +\n          labs(x =\"Milhares de Barris por Dia\", y = \"\") +\n          \n          ggtitle(\"Os 10 Maiores Produtores de Petróleo em 2020\") +\n          geom_label(size = 3)\n```\n\n::: {.cell-output-display}\n![](Petroleum_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nEmbora o Brasil não tenha as maiores reservas de petróleo, ele pertence ao grupo dos maiores produtores.\n\nAgora podemos analizar a produção anual de petróleo do Brasil.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Texto com quebra de linha\nTexto <- paste(\n  strwrap(\"Aumento da extração de petróleo do Pré-Sal no ano de 2015\",\n          20),\n  collapse = \"\\n\")\n\nProducao_internacional %>% filter(PAÍS ==\"Brasil\") %>% \n  ggplot() +\n   aes(x = ANO,y=PRODUÇÃO) +\n \n  geom_line(size =1.2,colour = \"grey\" ) +\n    scale_x_continuous(\n      breaks =c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020)) +\n  labs(y = \"Milhares de Barris por dia\") +\n  \n  geom_point(size = 3, colour = \"black\") +\n  \n  #Textos\n  annotate(\"text\",x = 2012 ,y =2800,size = 6,\n           label = \"BRASIL\", fontface = \"bold\",colour = \"green\") +\n  annotate(\"text\",x = 2018 ,y =2300,size = 5,\n           label = Texto, fontface = \"bold\",colour = \"red\") +\n   \n  #destacar um ponto\n  gghighlight(\n    ANO ==2015,\n    label_key = PRODUÇÃO,\n    #unhighlighted_colour = \"grey\",\n    label_params = list(size = 3.5,\n                        face = \"bold\",\n                        fill = \"red\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Could not calculate the predicate for layer 3, layer 4; ignored\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Ignoring unknown parameters: face\n```\n:::\n\n::: {.cell-output-display}\n![](Petroleum_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nQuem foram os maiores consumidores em 2020?\n\nCarregando os dados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconsumo_internacional <- readr::read_csv2(\"https://www.gov.br/anp/pt-br/centrais-de-conteudo/publicacoes/anuario-estatistico/arquivos-anuario-estatistico-2021-metadados-pdf-e-dados-abertos-csv/secao-1-panorama-internacional/dados-abertos-csv/anuario-2021-dados_abertos-tabela1-3.csv\")\n```\n:::\n\n\nUsando o pacote knitr para formatar tabelas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconsumo_internacional %>% \n  filter(ANO ==2020) %>% select(2:3) %>%  \n  arrange(desc(`CONSUMO DE PETRÓLEO`)) %>% slice(1:10) %>% \n  head(10) %>% \n  knitr::kable(col.names = c(\"País\",\"Consumo de Petróleo (mil barris por dia)\"))\n```\n\n::: {.cell-output-display}\n|País           | Consumo de Petróleo (mil barris por dia)|\n|:--------------|----------------------------------------:|\n|Estados Unidos |                                    17178|\n|China          |                                    14225|\n|Índia          |                                     4669|\n|Arábia Saudita |                                     3544|\n|Japão          |                                     3268|\n|Rússia         |                                     3238|\n|Coreia do Sul  |                                     2560|\n|Brasil         |                                     2323|\n|Canadá         |                                     2282|\n|Alemanha       |                                     2045|\n:::\n:::\n\n\nE no Brasil? Quais estados tem reserva de petróleo?\n\nCarregando dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBr_Reservas <- readr::read_csv2(\"https://www.gov.br/anp/pt-br/centrais-de-conteudo/publicacoes/anuario-estatistico/arquivos-anuario-estatistico-2021-metadados-pdf-e-dados-abertos-csv/secao-2-industria-nacional-do-petroleo-e-do-gas-natural/dados-abertos-csv/anuario-2021-dados_abertos-tabela2-3.csv\")\n```\n:::\n\n\nAqui iremos somar as reservas marítimas e terrestres.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Vamos agrupar total das reservas(terra e mar)\nTotal_estados <- Br_Reservas %>% filter(ANO == 2020) %>% \n  group_by(`UNIDADES DA FEDERAÇÃO`) %>% \n  dplyr::summarise(\n    sum(\n      Total =`RESERVAS TOTAIS DE PETRÓLEO (EM MILHÕES DE BARRIS)`),\n      Count= n()\n    ) %>% \n  #renomeando as colunas\n  plyr::rename(replace =c(\"sum(Total = `RESERVAS TOTAIS DE PETRÓLEO (EM MILHÕES DE BARRIS)`)\"=\"Total\",\"UNIDADES DA FEDERAÇÃO\" = \"name_state\"))\n #Renomeando alguns itens\nTotal_estados$name_state[Total_estados$name_state ==\"Paraná5\"] <- \"Paraná\"\nTotal_estados$name_state[Total_estados$name_state ==\"Rio de Janeiro3\"] <- \"Rio De Janeiro\"\nTotal_estados$name_state[Total_estados$name_state ==\"Santa Catarina6\"] <- \"Santa Catarina\"\nTotal_estados$name_state[Total_estados$name_state ==\"São Paulo4\"] <- \"São Paulo\"\nTotal_estados$name_state[Total_estados$name_state ==\"Rio Grande do Norte\"] <- \"Rio Grande Do Norte\"\n#Formatando a tabela\nTotal <-Total_estados %>% \n  select(1:2) %>% kable(col.names = c(\"UF\",\"Total\"))\n\nTotal\n```\n\n::: {.cell-output-display}\n|UF                  |        Total|\n|:-------------------|------------:|\n|Alagoas             | 4.040435e+00|\n|Amazonas            | 5.153600e+01|\n|Bahia               | 2.938644e+02|\n|Ceará               | 2.428873e-01|\n|Espírito Santo      | 1.314880e+03|\n|Maranhão            | 2.139806e-01|\n|Paraná              | 0.000000e+00|\n|Rio De Janeiro      | 1.603287e+04|\n|Rio Grande Do Norte | 2.662763e+02|\n|Santa Catarina      | 0.000000e+00|\n|São Paulo           | 2.079593e+03|\n|Sergipe             | 1.947730e+02|\n:::\n:::\n\n\nPodemos apresentar os resultado na forma de mapa\n\nA biblioteca geobr nos force uma malha de pontos que podemos usar para construir mapas.\n\nCarregando os dados de 2017.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMapa <-geobr::read_state(year = 2017)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n:::\n\n\nAgora podemos unir as tabelas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# um pequeno malabarismo para plotar o mapa completo\nv1 <-c(\"Rio Grande Do Sul\",\"Minas Gerais\",\"Mato Grosso Do Sul\",\n       \"Mato Grosso\",\"Goiás\",\"Distrito Federal\",\"Piauí\",\"Paraíba\",\n       \"Pernambuco\",\"Rondônia\",\"Acre\",\"Roraima\",\"Pará\",\"Amapá\",\n       \"Tocantins\")\nv2 <-rep(0,15)\n# selecionar as colunas de interesse\nTotal_estados <- Total_estados %>% select(1:2)\n\n#adicionando linhas ao dataframe\nlinhas <-data.frame(name_state =v1,Total = v2)\n\nTotal_estados <- rbind(Total_estados,linhas)\n\n#Finalmente unindo as tabelas \nEstados <- merge(Mapa, Total_estados, by = c(\"name_state\"))\n```\n:::\n\n\nPlotando o Gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  Estados %>% ggplot() +\n    geom_sf(aes(fill=Total), color= \"black\", size=.15) +\n      labs(subtitle=\"Reservas Totais Estimadas em 2020\", size=8) +\n      scale_fill_distiller(palette = \"Oranges\",direction=1, \n                           name=\"Milhões de Barris\") +\n      theme_minimal() \n```\n\n::: {.cell-output-display}\n![](Petroleum_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n# Conclusão\n\nA biblioteca ggplot é poderosa. Ela permite fazer vários tipos de edição no gráfico, gerando diversas visualizações com muita facilidade.\n\n# Referências\n\n-   [Curso R](https://livro.curso-r.com)\n\n-   [Beatriz Milz](https://beamilz.com)\n\n-   [Olivier Gimenez](https://oliviergimenez.github.io/intro_tidyverse/#1)\n",
    "supporting": [
      "Petroleum_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
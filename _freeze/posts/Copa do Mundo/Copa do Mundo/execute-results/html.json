{
  "hash": "02c5990853ff278a73b106b8a574fbca",
  "result": {
    "markdown": "---\ntitle: \"Usando R para acessar google sheet\"\nauthor: \"Jorge Luiz Mendes\"\ndescription: \"Isso é um pequeno tutorial para acessar o google sheets com a biblioteca googlesheets4 e base de dados utilizada vai ser da copa do mundo.\"\nimage: \"2022_FIFA_World_Cup.png\" \neditor: visual\ndate: \"2022-11-05\"\nbibliography: references.bib\n---\n\n\n## Introdução\n\nO [@googlesheets4] é um pacote que pode acessas dados de planilhas do google sheets via API. É interessante armazenar dados na nuvem, pois economiza memória e te permite acessa-los de outros locais de uma forma segura.\n\n## Os Dados\n\nOlhando o youtube me deparei com um evento gratuito de ensino de Power Bi e Excel com tema copa do mundo nada mais justo do que dar os devidos créditos, [Leonardo - Power Bi Experience](https://www.youtube.com/c/AprendaPowerBI).\n\nA planilha (xlsx) foi baixada e convertida para uma google sheet (***Explicado nesse tópico: [Manipulações]***). É um conjunto de dados sobre a copa do mundo que traz o desempenho das seleções em cada edição, os artilheiros e detalhes das finais.\n\n## Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(googlesheets4)\n\nlibrary(dplyr)\nlibrary(knitr)\nlibrary(magrittr)\nlibrary(purrr)\n\nlibrary(ggplot2)\nlibrary(ggbump)\n```\n:::\n\n\n## Autenticação\n\nPrimeiro armazenar o link da planilha.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_dados <- \"https://docs.google.com/spreadsheets/d/1urL93VWfy0R_hqNjNq-fdQdXF6Ta9L38k5wVuubL9Zw/edit#gid=659891394\"\n```\n:::\n\n\nAo executar qualquer função desse pacote você será levado a seguinte página do seu Browser.\n\n![Escolher um email para autênticação](authGS.png){fig-align=\"center\" width=\"384\"}\n\nDar a permissão para editar, criar excluir dados da planilha.\n\n![Autorização para a manipulação da planilha.](authGS2.png){fig-align=\"center\" width=\"306\"}\n\nApós a primeira autênticação as requisições passam ser autorizadas via console do RStudio.\n\nA função `sheet_properties` mostra quais são as planilhas que estão na pasta de trabalho.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsheet_properties(url_dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25 x 8\n   name        index         id type  visible grid_rows grid_columns data  \n   <chr>       <int>      <int> <chr> <lgl>       <int>        <int> <list>\n 1 País            0          0 GRID  TRUE         1000           26 <NULL>\n 2 Copa_Final      1  739370969 GRID  TRUE         1000           26 <NULL>\n 3 Artilheiros     2  332312744 GRID  TRUE         1000           26 <NULL>\n 4 Disputas        3 1811446063 GRID  TRUE         1000           26 <NULL>\n 5 1930            4 1245394281 GRID  TRUE         1000           26 <NULL>\n 6 1934            5  199002872 GRID  TRUE         1000           26 <NULL>\n 7 1938            6  659891394 GRID  TRUE         1000           26 <NULL>\n 8 1950            7 1547033404 GRID  TRUE         1000           26 <NULL>\n 9 1954            8  946131332 GRID  TRUE         1000           26 <NULL>\n10 1958            9   35115059 GRID  TRUE         1000           26 <NULL>\n# ... with 15 more rows\n```\n:::\n:::\n\n\n## Manipulações\n\nExiste conjunto de planilhas nesta base e podemos uni-las para criar uma tabela só.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlista_de_copas  <-list(\"1930\",\"1934\",\"1938\",\"1950\",\"1954\",\n                       \"1958\",\"1962\",\"1966\",\"1970\",\"1974\",\n                       \"1978\",\"1982\",\"1986\",\"1990\",\"1994\",\n                       \"1998\",\"2002\",\"2006\",\"2010\",\"2014\",\n                       \"2018\")\n\ndf <-data.frame()\n\nfor(i in lista_de_copas){\n  \n  df <- rbind(df,read_sheet(url_dados,sheet = i))\n  \n  \n}\n```\n:::\n\n\n::: {.callout-caution collapse=\"true\"}\n## Tipo de Arquivo\n\nÉ comum confundir o tipo de extensão do arquivo. A biblioteca `{googlesheet4}` é para ler e manipular planilhas criadas utilizando google sheets e não planilhas xlsx (excel microsoft).\n:::\n\nVerificando o tipo de dado.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 457\nColumns: 9\n$ Ano           <dbl> 1930, 1930, 1930, 1930, 1930, 1930, 1930, 1930, 1930, 19~\n$ Posição       <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1, 2, 3, 4, 5~\n$ NumJogos      <chr> \"4\", \"5\", \"3\", \"3\", \"3\", \"2\", \"3\", \"2\", \"2\", \"2\", \"2\", \"~\n$ Vitórias      <dbl> 4, 4, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0, 4, 3, 3, 2, 1, 1,~\n$ Empates       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0,~\n$ Derrotas      <dbl> 0, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 2, 3, 0, 1, 1, 2, 1, 1,~\n$ `Gols Pro`    <dbl> 15, 18, 7, 7, 5, 5, 4, 3, 1, 1, 0, 0, 4, 12, 9, 11, 7, 4~\n$ `Gols Contra` <dbl> 3, 9, 6, 7, 3, 2, 3, 5, 3, 4, 4, 8, 13, 3, 6, 8, 7, 3, 4~\n$ Seleção       <chr> \"Uruguai\", \"Argentina\", \"Estados Unidos\", \"Sérvia\", \"Chi~\n```\n:::\n:::\n\n\nQuem mais jogou?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% group_by(Seleção) %>% \n  summarise(total_jogos = sum(as.numeric(NumJogos))) %>%\n  arrange(desc(total_jogos)) %>% \n  slice(1:5) %>% \n  ggplot(aes(x = Seleção, y= total_jogos,label =total_jogos)) +\n  geom_col(fill = \"#0b8d96\") +\n  geom_text(position = position_stack(vjust = 1.05),\n            color =\"#011112\")+\n  labs(title = \"Seleções que mais jogaram\",\n       subtitle = \"Dados agregados desde a copa de 1934\",\n       y = \"\",x =\"seleções\") +\n  theme(plot.title = element_text(face = \"bold\",size = 12),\n        plot.subtitle = element_text(face= \"italic\",size =10),\n        )\n```\n\n::: {.cell-output-display}\n![](Copa-do-Mundo_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nDesempenho do Brasil.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%filter(Seleção == \"Brasil\")%>% select(1:6) %>%   \n  tail() %>% \n  kable(caption = \"Desempenho do Brasil nas últimas copas\",\n        col.names = c(\"Ano\",\"Posição\",\"Número de Jogos\",\n                      \"Vitórias\",\"Empates\",\"Derrotas\"),\n        align = \"cccccc\")\n```\n\n::: {.cell-output-display}\nTable: Desempenho do Brasil nas últimas copas\n\n| Ano  | Posição | Número de Jogos | Vitórias | Empates | Derrotas |\n|:----:|:-------:|:---------------:|:--------:|:-------:|:--------:|\n| 1998 |    2    |        7        |    4     |    1    |    2     |\n| 2002 |    1    |        7        |    7     |    0    |    0     |\n| 2006 |    5    |        5        |    4     |    0    |    1     |\n| 2010 |    6    |        5        |    3     |    1    |    1     |\n| 2014 |    4    |        7        |    3     |    2    |    2     |\n| 2018 |    6    |        5        |    3     |    1    |    1     |\n:::\n:::\n\n\nDesempenho das seleções campeãs de copa do mundo\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %<>% group_by(Seleção) %>% \n  mutate(campeao = if_else(Posição ==1,1,0),\n         Titulo_acumulado = purrr::accumulate(.x = campeao, \n                                    .f = ~ .x + .y))\n\n\ndf %>% filter(Titulo_acumulado !=0) %>% \n  ggplot(aes(Ano,Titulo_acumulado,color =Seleção))+\n  geom_bump(size =1.5) +\n  geom_point(size =3) +  \n  labs(title = \"Desempenho das Seleções\",\n       subtitle = \"1930-2018\",\n       x =\"Ano\",\n       y =\"Número de Títulos\") + \n  scale_x_continuous(breaks = seq(1930,2018,4)) +\n  theme(plot.title = element_text(face =\"bold\", size = 14),\n        plot.subtitle = element_text(face = \"italic\", size = 10,\n                        margin = margin(b = 0.5, unit = \"cm\")),\n        axis.text.y = element_text(face =\"bold\",size =10,\n                                    colour = \"#030202\"),\n        axis.text.x = element_text(face =\"bold\",size =10,\n                                    colour = \"#030202\",\n                                   angle = 90),\n        )\n```\n\n::: {.cell-output-display}\n![](Copa-do-Mundo_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nTodas as seleções que venceram a copa do mundo fizeram mais gols?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmaxGols <-df %>% group_by(Ano) %>% \n  summarise(nmaxgols = max(`Gols Pro`))\n\ncamp_edicao <- df %>% filter(Posição == 1)\n\nTexto <- paste(\n  strwrap(\"Número máximo de gols\",15),\n  collapse = \"\\n\")\n\n#Geralmente adoto um padrão os gráficos mas por algum motivo o ggplot não estava reconhecendo os nomes das colunas.\nggplot() +\n  geom_line(aes(x =maxGols$Ano,\n                y =maxGols$nmaxgols),\n            linetype = 1) +\n  scale_x_continuous(breaks = seq(1930,2018,4)) +\n  geom_point(aes(x=camp_edicao$Ano,\n                 y=camp_edicao$`Gols Pro`,\n                 color = camp_edicao$Seleção),\n             size = 2.1) +\n  scale_color_brewer(palette=\"Paired\") +\n  labs(title = \"Gols por Copa\",\n       subtitle = \"Seleções Campeãs de 1930 até 2018\",\n       x=\"Ano\",\n       y =\"Gols\",\n       color = \"Seleção Campeã\"\n       ) +\n   annotate(\"text\",x = 1938 ,y =23,size = 3,\n           label = Texto, fontface=\"bold\",colour=\"black\")+\n  theme(plot.title = element_text(face =\"bold\", size = 14),\n        plot.subtitle = element_text(face = \"italic\", size = 10,\n                        margin = margin(b = 0.5, unit = \"cm\")),\n        axis.text.y = element_text(face =\"bold\",size =10,\n                                    colour = \"#030202\"),\n        axis.text.x = element_text(angle = 90,\n                                   face =\"bold\",size =10,\n                                    colour = \"#030202\")) \n```\n\n::: {.cell-output-display}\n![](Copa-do-Mundo_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nSinceramente eu não lembrava que a **La Fúria** (Seleção Espanhola) tinha marcado poucos gols em 2010 (Ano do Título), o time de Xavi e Iniesta era conhecido pela alta posse de bola e pela grande quantidade de passes, a Alemanha marcou o dobro de gols nesta edição.\n\n## Ver também\n\n-   [Beatriz Milz](https://beamilz.com/posts/2022-03-08-googlesheets4/pt/index.html)\n",
    "supporting": [
      "Copa-do-Mundo_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "5f51c9b781f638584837afe5ef2673af",
  "result": {
    "markdown": "---\ntitle: \"Arbitragem da Premier League\"\nauthor: \"Jorge Luiz Mendes\"\ndate: \"2024-01-06\"\ncategories: [analysis,futebol,PL,ggplot]\nimage: \"image0.png\"\ndescription: \"Como é a arbitragem da Premier League?\"\n---\n\n\n## Intodução\n\nA premier League é a liga mais famomasa do mundo, sendo transmitida em vários países, ela é conhecida por ter grandes craques e um jogo frenético.\n\n![Imagem de divulgação da Premier League.](image0.png){fig-align=\"center\" width=\"614\"}\n\nEsse tipo jogo é permitido por conta de uma arbitragem mais permissiva aos contatos físicos entre jogadores, sempre dando preferência pela continuidade da partida realizando pouquissimas intervenções.\n\nO meu objetivo é analisar a temporada 2021-2022 do ponto de vista da arbitragem levando em consideração cartões , n°jogos e outros parâmetros.\n\n## Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr) #tratamento de dados\nlibrary(ggplot2) #gráficos\nlibrary(readr) #leitura de dados\nlibrary(lubridate) #tratamento de dados \nlibrary(glue)\nlibrary(knitr) #tabelas \n```\n:::\n\n\n## Dados\n\nO dataset foi disponibilizado pelo projeto [tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-04/readme.md) com a autoria de [Evan Gower](https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-04/readme.md). O projeto disponibiliza diversas bases de dados reais e de forma gratuita.\n\nOs dados podem ser carregados pela biblioteca:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"tidytuesdayR\")\ntuesdata <- tidytuesdayR::tt_load('2023-04-04')\ntuesdata <- tidytuesdayR::tt_load(2023, week = 14)\nsoccer <- tuesdata$soccer\n```\n:::\n\n\nOu pelo link disponibilizado no GitHub.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- readr::read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-04/soccer21-22.csv\")\ndados |> head() |> \n  knitr::kable(caption = \"Tabela\")\n```\n\n::: {.cell-output-display}\nTable: Tabela\n\n|Date       |HomeTeam   |AwayTeam       | FTHG| FTAG|FTR | HTHG| HTAG|HTR |Referee   | HS| AS| HST| AST| HF| AF| HC| AC| HY| AY| HR| AR|\n|:----------|:----------|:--------------|----:|----:|:---|----:|----:|:---|:---------|--:|--:|---:|---:|--:|--:|--:|--:|--:|--:|--:|--:|\n|13/08/2021 |Brentford  |Arsenal        |    2|    0|H   |    1|    0|H   |M Oliver  |  8| 22|   3|   4| 12|  8|  2|  5|  0|  0|  0|  0|\n|14/08/2021 |Man United |Leeds          |    5|    1|H   |    1|    0|H   |P Tierney | 16| 10|   8|   3| 11|  9|  5|  4|  1|  2|  0|  0|\n|14/08/2021 |Burnley    |Brighton       |    1|    2|A   |    1|    0|H   |D Coote   | 14| 14|   3|   8| 10|  7|  7|  6|  2|  1|  0|  0|\n|14/08/2021 |Chelsea    |Crystal Palace |    3|    0|H   |    2|    0|H   |J Moss    | 13|  4|   6|   1| 15| 11|  5|  2|  0|  0|  0|  0|\n|14/08/2021 |Everton    |Southampton    |    3|    1|H   |    0|    1|A   |A Madley  | 14|  6|   6|   3| 13| 15|  6|  8|  2|  0|  0|  0|\n|14/08/2021 |Leicester  |Wolves         |    1|    0|H   |    1|    0|H   |C Pawson  |  9| 17|   5|   3|  6| 10|  5|  4|  1|  2|  0|  0|\n:::\n:::\n\n\n## Mão na massa\n\n**Quem apitou mais jogos?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados |> \n  dplyr::group_by(Referee) |> \n  dplyr::summarise(nJogos = n(),\n                   faltas = sum(HF) + sum(AF),\n                   amarelos = sum(HY) + sum(AY),\n                 vermelhos =sum(HR) + sum(AR) ) |> \n  dplyr::arrange(desc(nJogos)) |> \n  dplyr::slice(1:10) |> \n  knitr::kable(caption = \"Temporada 2021-2022\",\n               col.names = c(\"Árbitros\",\"N°Jogos\",\"N°Faltas\",\n                        \"Amarelos\",\"Vermelhos\"),\n               align = \"ccccc\")\n```\n\n::: {.cell-output-display}\nTable: Temporada 2021-2022\n\n|  Árbitros  | N°Jogos | N°Faltas | Amarelos | Vermelhos |\n|:----------:|:-------:|:--------:|:--------:|:---------:|\n|  A Taylor  |   28    |   548    |   101    |     5     |\n| P Tierney  |   27    |   583    |   103    |     5     |\n|  C Pawson  |   26    |   576    |   107    |     2     |\n| M Atkinson |   26    |   406    |    64    |     2     |\n|   M Dean   |   26    |   501    |    82    |     2     |\n|  M Oliver  |   26    |   551    |    73    |     7     |\n|   J Moss   |   25    |   448    |    58    |     4     |\n|  D Coote   |   20    |   476    |    90    |     2     |\n| S Attwell  |   20    |   364    |    70    |     1     |\n| A Marriner |   19    |   365    |    61    |     2     |\n:::\n:::\n\n\n**Em que mês saiu mais cartão amarelo?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_Jogos_cartao <-  dados |> \n  dplyr::mutate(mes = lubridate::month(Date,label = TRUE)) |> \n  dplyr::group_by(mes) |> \n  dplyr::summarise(jogos = n(),\n                   cartao = sum(HY) + sum(AY) + sum(HR) + sum(AR)) \n\ndf_Jogos_cartao |> ggplot2::ggplot(aes(x= mes, y =cartao, label = cartao)) +\n  ggplot2::geom_col(fill = \"#1b662c\" ) +\n  ggplot2::geom_label() +\n  labs(title = \"Distribuição de Cartões na Premier League\",\n       subtitle = \"Amarelos e vermelhos da temporada 2021-2022\",\n       x = \"Mês\", y = \"N°de Cartões\",\n       caption = \"Mendes, Jorge L.\") +\n  ggplot2::geom_hline(yintercept=mean(df_Jogos_cartao$cartao),linetype = 2) +\n  ggplot2::annotate(\"text\",x = 6,y =145, \n                    label = glue::glue(\"Média:{mean(df_Jogos_cartao$cartao)}\")) +\n  theme(plot.title = element_text(face = \"bold\",size = 14),\n         axis.text.y =element_text(face =\"bold\",\n                                    colour = \"#030202\"),\n         axis.text.x =element_text(face =\"bold\",\n                                    colour = \"#030202\"))\n```\n\n::: {.cell-output-display}\n![](Arbitragem_PL_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n## Curiosidade!!!\n\nAs competições Europeias seguem, em geral, o calendário é internacional. A temporada começa em agosto de determinado ano e termina em maio do ano seguinte. A premier league tem uma particularidade (se comparada com as outras grandes ligas) no seu calendário, o intervalo entre os jogos de dezembro é menor, tendo a rodada do [Boxing Day](#0) com partidas ocorrendo dia 26 de dezembro.\n:::\n\nO quanto o número de jogos impactam na quantidade de cartões?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_Jogos_cartao |> ggplot(aes(x = mes, y=jogos)) +\n  ggplot2::geom_point(aes(size = cartao),color= \"#424d6b\") +\n  labs(title = \"Distribuição de Jogos da Premier League\",\n       subtitle = \"Temporada 2021-2022\",\n       x = \"Mês\", y = \"N°de Jogos\",\n       caption = \"Mendes, Jorge L.,2024\") +  \n theme(plot.title = element_text(face = \"bold\",size = 14),\n         axis.text.y =element_text(face =\"bold\",\n                                    colour = \"#030202\"),\n         axis.text.x =element_text(face =\"bold\",\n                                    colour = \"#030202\"))\n```\n\n::: {.cell-output-display}\n![](Arbitragem_PL_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Cartões Amarelos\n\nDiferente do campeonato brasileiro é necessário 5 cartões para o jogador ser suspenso na Premier League.\n:::\n\n**Considerando os árbitros que mais distribuiram cartões amarelos nessa temporada (2021-2022). Quais os clubes preferidos deles?**\n\nSelecionando os árbitros e separando os times.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlista_arbitro <- c(\"C Pawson\",\"P Tierney\",\"A Taylor\",\"D Coote\")\na_H <- dados |> dplyr::filter(Referee %in% lista_arbitro) |> \n  dplyr::group_by(Referee,HomeTeam) |> \n  dplyr::summarise(cartaoH = sum(HY)) |>\n  dplyr::rename(time = HomeTeam)\na_A <- dados |> dplyr::filter(Referee %in% lista_arbitro) |> \n  dplyr::group_by(Referee,AwayTeam) |> \n  dplyr::summarise(cartaoA = sum(AY)) |>\n  dplyr::rename(time = AwayTeam)\n\ndf <-a_H |> dplyr::full_join(a_A) |> \n  dplyr::mutate(cartao = coalesce(cartaoH,0) + coalesce(cartaoA,0)) |> \n  dplyr::select(1,2,5) |> \n  dplyr::group_by(Referee) |> \n  dplyr::top_n(5,cartao)\n\n \nto_add <- data.frame( matrix(NA, 0,ncol(df)) )\ncolnames(to_add) <- colnames(df)\nto_add$Referee <- rep(levels(df$Referee), each = 0)\nto_add$time <- as.factor(to_add$time)\n\ndf <- rbind(df, to_add)\ndf <- df %>% arrange(Referee)\ndf$id <- seq(1, nrow(df))\n```\n:::\n\n\nConstruindo os arcos e definindo os limites.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlabel_data <- df\nnumber_of_bar <- nrow(label_data)\nangle <- 90 - 360 * (label_data$id-0.5) /number_of_bar     \nlabel_data$hjust <- ifelse(angle < -90, 1, 0)\nlabel_data$angle <- ifelse(angle < -90, angle+180, angle)\nbase_data <- df |> \n  group_by(Referee) |>  \n  summarize(start=min(id), end=max(id) ) |> \n  rowwise() |> \n  mutate(title=mean(c(start, end)))\n\ngrid_data <- base_data\ngrid_data$end <- grid_data$end[ c( nrow(grid_data), 1:nrow(grid_data)-1)] + 1\ngrid_data$start <- grid_data$start - 1\ngrid_data <- grid_data[-1,]\n```\n:::\n\n\nFinalmente podemos construir o gráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x=as.factor(id), y=cartao, fill=Referee)) +      \n  \n  geom_bar(aes(x=as.factor(id), y=cartao, fill=Referee), \n           stat=\"identity\", alpha=0.5) +\n  \n  \n  geom_bar(aes(x=as.factor(id), y=cartao, fill=Referee)\n           , stat=\"identity\", alpha=0.5) +\n  ylim(-100,120) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    panel.grid = element_blank(),\n    plot.margin = unit(rep(-1,4), \"cm\") \n  ) +\n  coord_polar() + \n  geom_text(data=label_data, aes(x=id, y=cartao+10, label=time, hjust=hjust), \n            color=\"black\", fontface=\"bold\",alpha=0.6, \n            size=2.5, angle= label_data$angle, inherit.aes = FALSE ) +\n  \n  geom_segment(data=base_data, aes(x = start, y = -5, xend = end, yend = -5),\n               colour = \"black\", alpha=0.8, linewidth=0.6 , inherit.aes = FALSE )  +\n  geom_text(data=base_data, aes(x = title, y = -15, label=Referee),\n            hjust=c(0.95,0.95,0.1,0.1), colour = \"black\", alpha=0.8, size=3, \n            fontface=\"bold\", inherit.aes = FALSE) \n```\n\n::: {.cell-output-display}\n![](Arbitragem_PL_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Conclusão\n\nO [tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-04-04/readme.md) é uma excelente uma excelente biblioteca, pois fornece bastante bases de dados para praticar permitindo diversos tipos de análises.\n",
    "supporting": [
      "Arbitragem_PL_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
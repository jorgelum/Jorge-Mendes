{
  "hash": "d758ffa653abf3e1b687f102e01ad019",
  "result": {
    "markdown": "---\ntitle: \"Campeonato Brasileiro\"\nauthor: \"Jorge Luiz Mendes\"\ndate: \"2022-07-14\"\ncategories: [analysis,new,code,futebol]\nimage: \"image1.png\"\ndescription: \"Analisando os resultados do campeonato brasileiro\"\n---\n\n\n# Campeonato Brasileiro\n\n## Objetivo\n\nExplorar a biblioteca [brasileirão](https://github.com/williamorim/brasileirao). É uma boa base para praticar, principalmente, manipulações de dataframe.\n\nEla consegue, além de outras coisas, retornar jogos, a data, o placar e os clubes envolvidos desde 2003 no campeonato brasileiro de futebol.\n\n## Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(magrittr)\nlibrary(plyr)\nlibrary(lubridate)\nlibrary(calendR)\nlibrary(brasileirao)\nlibrary(knitr)\nlibrary(treemap)\nlibrary(gghighlight)\nlibrary(jpeg)\nlibrary(patchwork)\n```\n:::\n\n\n## **Mão na Massa**\n\nCarregando dados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nBr <- brasileirao::matches\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(head(Br))\n```\n\n::: {.cell-output-display}\n| season|date       |home         |score |away        |\n|------:|:----------|:------------|:-----|:-----------|\n|   2003|2003-03-29 |Athletico PR |2x0   |Grêmio      |\n|   2003|2003-03-29 |Guarani      |4x2   |Vasco       |\n|   2003|2003-03-30 |Corinthians  |0x3   |Atlético MG |\n|   2003|2003-03-30 |Goiás        |2x2   |Paysandu    |\n|   2003|2003-03-30 |Criciúma     |2x0   |Fluminense  |\n|   2003|2003-03-30 |Cruzeiro     |2x2   |São Caetano |\n:::\n:::\n\n\nVerificando os tipos de variáveis das colunas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(Br)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 8,026\nColumns: 5\n$ season <dbl> 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003, 200~\n$ date   <date> 2003-03-29, 2003-03-29, 2003-03-30, 2003-03-30, 2003-03-30, 20~\n$ home   <chr> \"Athletico PR\", \"Guarani\", \"Corinthians\", \"Goiás\", \"Criciúma\", ~\n$ score  <chr> \"2x0\", \"4x2\", \"0x3\", \"2x2\", \"2x0\", \"2x2\", \"1x1\", \"0x0\", \"1x1\", ~\n$ away   <chr> \"Grêmio\", \"Vasco\", \"Atlético MG\", \"Paysandu\", \"Fluminense\", \"Sã~\n```\n:::\n:::\n\n\nRealizando algumas manipulações para obter resultados dos jogos a partir de 2010.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTabela_extendida <- Br  %>% filter(season >=2010)  %>% \n  separate(score,\n           c(\"Placar_Mandante\",\"Placar_Visitante\"),\n           sep = \"x\",\n           convert = TRUE\n    \n  ) %>% \n  mutate(\n    Mandante = case_when(\n      Placar_Mandante > Placar_Visitante~\"Venceu\",\n      Placar_Mandante < Placar_Visitante~\"Perdeu\",\n      Placar_Mandante == Placar_Visitante~\"Empate\"\n    ),\n     Visitante = case_when(\n      Placar_Mandante < Placar_Visitante~\"Venceu\",\n      Placar_Mandante > Placar_Visitante~\"Perdeu\",\n      Placar_Mandante == Placar_Visitante~\"Empate\"\n    )\n  )\n```\n:::\n\n\nA ideia aqui é selecionar um clube e fazer as análises a partir dessa escolha. Vamos criar uma função para selecionar um time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nClubes<-function(dataframe,Time){\n  #selcionar o clube quando ele é mandante\n  TimeMandante <-dataframe %>% filter(home==Time) %>% \n  select(season,date,home,Placar_Mandante,\n         Placar_Visitante,Mandante) %>% \n  plyr::rename(\n    replace = c(\"home\"=\"clube\",\n                \"Placar_Mandante\"=\"Gols_Pro\",\n                \"Placar_Visitante\"=\"Gols_Contra\",\n                \"Mandante\"=\"Resultado\"))\n  \n  #selcionar o clube quando ele é visitante\n  TimeVisitante <- dataframe %>% \n  filter(away==Time) %>% \n  select(season,date,away,Placar_Visitante,\n         Placar_Mandante,Visitante) %>% \n  plyr::rename(\n    replace = c(\"away\"=\"clube\",\n                \"Placar_Visitante\"=\"Gols_Pro\",\n                \"Placar_Mandante\"=\"Gols_Contra\",\n                \"Visitante\"=\"Resultado\")) \n  \n  #Unindo as tabelas\n  Resultados <-rbind(TimeMandante,TimeVisitante)\n  \n  return(Resultados)\n  \n}\n```\n:::\n\n\nSelecionando um time.\n\nO interessante é selecionar um clube que jogou muitas edições para ter uma boa quantidade de dados. Convenientemente foi selcionado o Corinthians.\n\n![](https://logodownload.org/wp-content/uploads/2016/11/corinthians-logo-0-1536x1536.png){fig-align=\"center\" width=\"400\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTimao<-Clubes(dataframe= Tabela_extendida,Time =\"Corinthians\")\n```\n:::\n\n\nÉ interessante adicionar os pontos obtidos em cada partida.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTimao <- Timao %>% mutate(\n  Pontos = case_when(\n  Resultado ==\"Venceu\"~3,\n  Resultado ==\"Empate\"~1,\n  Resultado ==\"Perdeu\"~0,\n))\n```\n:::\n\n\nUsando o pacote lubridate para tratar datas, obtendo informações sobre o dia,dia da semana, mês e ano de forma isolada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTimao$dia_Mes <- lubridate::day(Timao$date)\nTimao$Mes <- lubridate::month(Timao$date)\nTimao$NdiaSemana <- lubridate::wday(Timao$date)\n\nTimao <-Timao %>% mutate(\n\n  dia_semana = case_when(\n\n    NdiaSemana == 1 ~\"Domingo\",\n\n    NdiaSemana == 2 ~\"Segunda-Feira\",\n\n    NdiaSemana == 3 ~\"Terça-Feira\",\n\n    NdiaSemana == 4 ~\"Quarta-Feira\",\n\n    NdiaSemana == 5 ~\"Quinta-Feira\",\n\n    NdiaSemana == 6 ~\"Sexta-Feira\",\n\n    NdiaSemana == 7 ~\"Sábado\"\n\n    \n\n  )\n\n)\n```\n:::\n\n\nQual o número de vitórias, empates e derrotas da última década?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTimao %>% na.omit() %>% count(\"Resultado\") %>% \n  treemap(index = c(\"freq\",\"Resultado\"),\n          vSize = \"freq\",\n          align.labels=list(c(\"center\", \"center\"),c(\"center\", \"top\")),\n          title = \"Resultados do Corinthians desde 2010\",\n          fontsize.labels=c(15,12),\n          palette = c(\"#cfc6c6\",\"#3d3a3a\",\"#0a0a0a\")\n           \n           )\n```\n\n::: {.cell-output-display}\n![](Campeonato-Brasileiro_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nQual a pontuação das últimas temporadas?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npontuacao <-Timao %>% na.omit() %>% group_by(season) %>% \n  dplyr::summarise(\n    sum(Total =Pontos)) %>% \n  plyr::rename(\n    replace = c(\"sum(Total = Pontos)\"=\"Pontuação\")) \n\n#Gambiarra para plotar os anos em que foi campeão\npontuacao <- pontuacao %>% mutate(Titulo = case_when(\n  season ==2011 ~\"Campeão\",\n  season ==2015 ~\"Campeão\",\n  season ==2017 ~\"Campeão\",\n  TRUE ~\" \"\n  \n))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTexto <- paste(\n  strwrap(\"A temporada de 2022 ainda não foi concluída\",\n          20),\n  collapse = \"\\n\")\n\npath <-\"escudo1.jpg\"\nimg <- readJPEG(path,native = TRUE)\n\np1 <- pontuacao%>% \n  ggplot(aes(x =season,y =Pontuação))+ \n  ggtitle(\"Desempenho do Clube\") +\n  labs(x =\"Temporada\")   \n  \np1 + geom_line(size =1.2,colour= \"grey\") +\n    scale_x_continuous(\n      breaks =c(2010,2011,2012,2013,2014,2015,\n                2016,2017,2018,2019,2020,2021,2022)) +  \n  geom_point(size = 2,color=\"grey\") +\n  geom_point(\n    aes(x = season,y=Pontuação,color=Titulo)) +\n  \n  theme(\n    axis.text.x = element_text(angle = 90),legend.position = \"none\") +\nscale_color_manual(values=c(\"#999999\", \"#050101\")) +\n  annotate(\"text\",x = 2011,y =79,size = 5,\n           label = \"Campeão\", fontface = \"bold\",colour = \"black\")+\n  annotate(\"text\",x = 2019 ,y =38,size = 4,\n           label = Texto, fontface = \"bold\",colour = \"red\") +\n  inset_element(p = img,\n                left = 1.00,\n                bottom = 0.65,\n                right = 0.75,\n                top = 0.95)\n```\n\n::: {.cell-output-display}\n![](Campeonato-Brasileiro_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n## Conclusão\n\nA biblioteca brasileirao é excelente . Foi possível extrair bastante informação. Ela fornece de forma simples os dados gerais sobre as partidas, infelizmente ela não trás informações como número de cartões, tempo de jogo sem interrupções, posse bola, e entre outras. Não é terra arrasada, pois outros dados de fontes distintas podem ser adicionados para complementar as análises.\n\n## Referências\n\n-   [Blog Curso - R](https://blog.curso-r.com/posts/2021-03-05-brasileirao-sem-torcida/)\n\n-   [r - graph - gallery](https://r-graph-gallery.com/treemap.html)\n",
    "supporting": [
      "Campeonato-Brasileiro_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "4bdebd412fa718ab0e6903c1cb648969",
  "result": {
    "markdown": "---\ntitle: \"Saneamento no Estado de São Paulo\"\nauthor: \"Jorge Luiz Mendes\"\ndate: \"2022-09-10\"\neditor: visual\ncategories: [analysis,new,code,saneamento,csv,geobr,ggplot]\nimage: \"image.png\"\ndescription: \"Atlas do Esgoto\"\ndraft: false\ntoc: true\nbibliography: references.bib\n---\n\n\n## Objetivo\n\nSaneamento é um tema de extrema importâcia. Aqui o foco principal é fazer uma análise exploratória simples com ***dados públicos***.\n\n## Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(magrittr)\nlibrary(knitr)\nlibrary(geobr)\nlibrary(ggspatial)\nlibrary(sf)\n```\n:::\n\n\n## Os dados\n\n------------------------------------------------------------------------\n\nOs dados foram obtidos da agência nacional de águas e saneamento básico [ANA](https://www.gov.br/ana/pt-br).\n\nFoi utilizado o [Atlas Esgotos Situação 2013 - Remoção da Carga de Esgotos Gerada na Sede Municipal](https://dadosabertos.ana.gov.br/datasets/1bf952cbf5314d57882272656438dc1f_1/about) e o pacote **geobr** [@geobr] para acessar informações sobre os dados espaciais do Brasil.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- readr::read_delim(\"Atlas_Esgoto2013.csv\",delim = ',')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,570\nColumns: 14\n$ FID        <dbl> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1~\n$ MUN_CD_MUN <dbl> 1100015, 1100023, 1100031, 1100049, 1100056, 1100064, 11000~\n$ MUN_NM_MUN <chr> \"Alta Floresta D Oeste\", \"Ariquemes\", \"Cabixi\", \"Cacoal\", \"~\n$ MUN_UF     <chr> \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\",~\n$ MUN_NM_PRE <chr> \"Serviço Autônomo de Água e Esgoto\", \"Companhia de Águas e ~\n$ MUN_SIGLA_ <chr> \"SAAE\", \"CAERD\", \"PM\", \"SAAE\", \"PM\", \"PM\", \"PM\", \"PM\", \"PM\"~\n$ MUN_POPU_2 <dbl> 14735, 85770, 2771, 67665, 15276, 14097, 2665, 8689, 22741,~\n$ MUN_ICS    <dbl> 1.4244810, 2.0176413, 0.3713331, 0.0000000, 0.6727235, 1.02~\n$ MUN_IFSUTI <dbl> 1.8468146, 8.5762823, 0.6312662, 16.1786793, 19.6892988, 4.~\n$ MUN_ISCST  <dbl> 96.728704, 89.406076, 98.997401, 28.821321, 79.637978, 94.9~\n$ MUN_C_GERA <dbl> 795, 4631, 149, 3653, 824, 761, 143, 469, 1228, 2088, 2027,~\n$ MUN_C_REMA <dbl> 786, 4393, 149, 1791, 727, 742, 138, 445, 1126, 1907, 1986,~\n$ MUN_EFIC_1 <dbl> 1.1080888, 5.1457694, 0.3787597, 50.9572076, 11.8135793, 2.~\n$ MUN_ICT_FI <dbl> 0.000000, 0.000000, 0.000000, 55.000000, 0.000000, 0.000000~\n```\n:::\n:::\n\n\n## Manipulando as Bases\n\nRenomeando as colunas (consultei o aplicativo do ANA).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- dados %>% \n    dplyr::rename( \n        c(\"code_muni\" = \"MUN_CD_MUN\",\"municipio\"=\"MUN_NM_MUN\" ,\n          \"uf\"=\"MUN_UF\", \"prestador_servico\"= \"MUN_NM_PRE\" ,\n          \"sigla_prestador\"=\"MUN_SIGLA_\"  ,\n          \"populacao2013\" =\"MUN_POPU_2\" , \n                \n          \"Parcela_População_Com_Coleta_Sem_Tratamento(%)\" =\n            \"MUN_ICS\",\n                \n          \"Parcela_População_Com_Solução_Individual(%)\" =\n            \"MUN_IFSUTI\" ,\n                \n          \"Parcela_População_Sem_Coleta_Sem_Tratamento(%)\" =\n            \"MUN_ISCST\",\n                \n          \"Parcela_População_Com_Coleta_Com_Tratamento(%)\" =\n            \"MUN_ICT_FI\",\n                \n          \"Carga_Gerada\"= \"MUN_C_GERA\",\n          \"Carga_Remanescente\" =\"MUN_C_REMA\"  ,\n          \"Remoção_Carga_Orgânica(DBO)(%)\"=\"MUN_EFIC_1\"))\n```\n:::\n\n\nPodemos gerar tabelas com o pacote **knitr** para gerar tabelas.\n\nQuais cidades geram maior carga de esgoto no estado de são paulo?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados %>% filter(uf == \"SP\") %>% \n  select(c(\"municipio\",\"Carga_Gerada\")) %>% \n  arrange(desc(Carga_Gerada)) %>% \n  slice(1:10) %>% \n  knitr::kable(col.names = \n                 c(\"Municípios\",\"Carga Gerada Total (kgDBO/dia)\"),\n               \"simple\",caption = \"Estado de São Paulo\")\n```\n\n::: {.cell-output-display}\nTable: Estado de São Paulo\n\nMunicípios               Carga Gerada Total (kgDBO/dia)\n----------------------  -------------------------------\nSão Paulo                                        604822\nGuarulhos                                         65986\nCampinas                                          57323\nSão Bernardo do Campo                             43263\nOsasco                                            40435\nSanto André                                       38211\nSão José dos Campos                               35351\nRibeirão Preto                                    32560\nSorocaba                                          31355\nSantos                                            22833\n:::\n:::\n\n\nCarregando os dados do **geobr** para o estado de São Paulo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa <- geobr::read_municipality(code_muni = 35,year = 2018)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nUsing year 2018\n```\n:::\n:::\n\n\nUnindo as tabelas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsp <- dados %>% filter(uf ==\"SP\") %>% merge(mapa)\nnrow(sp) # verificando se possui as 645 cidades do estado de sp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 645\n```\n:::\n:::\n\n\nAgora podemos gerar mapas com os pontos **geom**.\n\nQuais cidades geram mais carga de esgoto no estado de São Paulo?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsp  %>% ggplot() +\n  geom_sf(aes(fill = Carga_Gerada, geometry = geom)) + \n  labs(title = \"Situação do Estado de São Paulo\",\n       subtitle = \"Carga Total Gerada 2013\") +\n  scale_fill_distiller(palette = \"Reds\",direction = 1,\n                       name= \"KgDBO/dia\") +\n  theme(axis.title=element_blank(),\n                   axis.text=element_blank(),\n                   axis.ticks=element_blank())\n```\n\n::: {.cell-output-display}\n![](Saneamento_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nPodemos verificar uma região específica ( como um conjunto de cidades). A forma mais segura é utilizar os códigos dos municípios, algumas cidades compartilham o mesmo nome.\n\nQual a porcentagem da população com coleta e tratamento de esgoto na região do grande ABC?\n\nAproveitei e adicionei o nome dos municípios, eixos das coordenadas, escala e a indicação do norte.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistaABC = list(3548708, 3547809, 3529401, 3513801, 3548807, 3543303, 3544103)\n\nsp %>%  filter(code_muni %in% listaABC) %>%\n  ggplot() + \n  geom_sf(aes(fill = `Parcela_População_Com_Coleta_Com_Tratamento(%)`,\n              geometry = geom)) +\n  \n  geom_sf_label(aes(label = municipio,geometry =geom),\n                label.padding = unit(0.5,\"mm\"),\n                size = 2) +\n  \n  \n  labs(title = \"Parcela da População Com Coleta e Com Tratamento\",\n       subtitle = \"Região do Grande ABC, 2013 \",\n       x = \"Longitude\",y =\"Latitude\") +\n  \n  scale_fill_distiller(palette = \"Greens\",direction = 1,\n                       name= \"(%)\") +\n  annotation_north_arrow(location = \"br\") +\n  annotation_scale(location =\"bl\"\n                   )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n:::\n\n::: {.cell-output-display}\n![](Saneamento_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## Ver também\n\n-   [Bea Milz](https://beamilz.com/posts/2020-07-27-criando-mapas-com-os-pacotes-tidyverse-e-geobr/pt/#dados-utilizados)\n",
    "supporting": [
      "Saneamento_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}